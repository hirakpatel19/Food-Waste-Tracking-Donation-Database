{% extends "base.html" %}

{% block title %}Edit Donation - {{ donation.title }}{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('donor.dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('donor.my_donations') }}">My Donations</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('donor.view_donation', id=donation.id) }}">{{ donation.title }}</a></li>
                    <li class="breadcrumb-item active">Edit</li>
                </ol>
            </nav>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="bi bi-pencil"></i> Edit Donation</h1>
                    <p class="text-muted mb-0">Update your food donation details</p>
                </div>
                <div>
                    <span class="badge bg-{{ donation.get_status_class() }} fs-6">
                        {{ donation.status.title() }}
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Form -->
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-body p-4">
                    <form method="POST" class="needs-validation" novalidate>
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <!-- Food Information -->
                            <div class="col-12">
                                <h5 class="text-success mb-3">Food Information</h5>
                            </div>
                            
                            <!-- Title -->
                            <div class="col-md-8 mb-3">
                                {{ form.title.label(class="form-label") }}
                                {{ form.title(class="form-control" + (" is-invalid" if form.title.errors else "")) }}
                                {% if form.title.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.title.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Category -->
                            <div class="col-md-4 mb-3">
                                {{ form.category_id.label(class="form-label") }}
                                {{ form.category_id(class="form-select" + (" is-invalid" if form.category_id.errors else "")) }}
                                {% if form.category_id.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.category_id.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Description -->
                            <div class="col-12 mb-3">
                                {{ form.description.label(class="form-label") }}
                                {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), rows="3") }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.description.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Quantity and Unit -->
                            <div class="col-md-6 mb-3">
                                {{ form.quantity.label(class="form-label") }}
                                {{ form.quantity(class="form-control" + (" is-invalid" if form.quantity.errors else "")) }}
                                {% if form.quantity.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.quantity.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                {{ form.unit.label(class="form-label") }}
                                {{ form.unit(class="form-select" + (" is-invalid" if form.unit.errors else "")) }}
                                {% if form.unit.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.unit.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Expiry Date -->
                            <div class="col-md-6 mb-3">
                                {{ form.expiry_date.label(class="form-label") }}
                                {{ form.expiry_date(class="form-control" + (" is-invalid" if form.expiry_date.errors else "")) }}
                                {% if form.expiry_date.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.expiry_date.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Dietary Info -->
                            <div class="col-md-6 mb-3">
                                {{ form.dietary_info.label(class="form-label") }}
                                {{ form.dietary_info(class="form-select" + (" is-invalid" if form.dietary_info.errors else "")) }}
                                {% if form.dietary_info.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.dietary_info.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Perishable -->
                            <div class="col-12 mb-4">
                                <div class="form-check">
                                    {{ form.is_perishable(class="form-check-input") }}
                                    {{ form.is_perishable.label(class="form-check-label") }}
                                </div>
                            </div>
                            
                            <!-- Pickup Information -->
                            <div class="col-12">
                                <h5 class="text-success mb-3">Pickup Information</h5>
                            </div>
                            
                            <!-- Pickup Address -->
                            <div class="col-md-8 mb-3">
                                {{ form.pickup_address.label(class="form-label") }}
                                {{ form.pickup_address(class="form-control" + (" is-invalid" if form.pickup_address.errors else ""), rows="2") }}
                                {% if form.pickup_address.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.pickup_address.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- City -->
                            <div class="col-md-4 mb-3">
                                {{ form.pickup_city.label(class="form-label") }}
                                {{ form.pickup_city(class="form-control" + (" is-invalid" if form.pickup_city.errors else "")) }}
                                {% if form.pickup_city.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.pickup_city.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Pickup Instructions -->
                            <div class="col-12 mb-4">
                                {{ form.pickup_instructions.label(class="form-label") }}
                                {{ form.pickup_instructions(class="form-control" + (" is-invalid" if form.pickup_instructions.errors else ""), rows="2") }}
                                {% if form.pickup_instructions.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.pickup_instructions.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Submit Buttons -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a href="{{ url_for('donor.view_donation', id=donation.id) }}" class="btn btn-secondary">
                                <i class="bi bi-x"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-check-circle"></i> Update Donation
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Donation Info -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <h5><i class="bi bi-info-circle"></i> Current Status</h5>
                    <div class="mb-3">
                        <span class="badge bg-{{ donation.get_status_class() }} fs-6">
                            {{ donation.status.title() }}
                        </span>
                    </div>
                    
                    <p class="small">
                        <strong>Created:</strong> {{ donation.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                    
                    {% if donation.updated_at != donation.created_at %}
                    <p class="small">
                        <strong>Last Updated:</strong> {{ donation.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                    {% endif %}
                    
                    <p class="small">
                        <strong>Days Until Expiry:</strong> 
                        <span class="{{ 'text-warning' if donation.is_urgent() else 'text-muted' }}">
                            {{ donation.days_until_expiry() }} days
                        </span>
                    </p>
                    
                    {% if donation.claim %}
                    <hr>
                    <h6 class="text-primary">Claimed by NGO</h6>
                    <p class="small mb-0">
                        <strong>{{ donation.claim.ngo.organization_name or donation.claim.ngo.full_name }}</strong><br>
                        Claimed: {{ donation.claim.claimed_at.strftime('%B %d, %Y') }}
                    </p>
                    {% endif %}
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-body">
                    <h6><i class="bi bi-exclamation-triangle text-warning"></i> Edit Limitations</h6>
                    <p class="small text-muted">
                        {% if donation.status == 'available' %}
                            You can edit all details of this donation since it hasn't been claimed yet.
                        {% else %}
                            This donation cannot be edited because it has already been {{ donation.status }}. 
                            Contact the NGO if you need to make changes.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}